<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Avanzada de Cálculo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="toggleTheme()">
        <i class="fas fa-sun"></i>
    </button>

    <!-- History Toggle Button -->
    <button class="history-toggle" onclick="toggleHistory()">
        <i class="fas fa-history"></i>
    </button>

    <!-- History Panel -->
    <div class="history-panel">
        <h2><i class="fas fa-history"></i> Historial de Cálculos</h2>
        <div id="history-list">
            <!-- Los elementos del historial se añadirán dinámicamente -->
        </div>
    </div>

    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay">
        <div class="tutorial-content">
            <button class="tutorial-close" onclick="closeTutorial()">
                <i class="fas fa-times"></i>
            </button>
            <h2>Bienvenido a la Calculadora Avanzada</h2>
            <div class="tutorial-steps">
                <p>1. Selecciona el tipo de cálculo que deseas realizar</p>
                <p>2. Ingresa la función o expresión matemática</p>
                <p>3. Para integrales, puedes elegir entre definida o indefinida</p>
                <p>4. Usa los botones de funciones para insertar expresiones comunes</p>
                <p>5. Guarda tus cálculos favoritos para uso futuro</p>
            </div>
        </div>
    </div>

    <div class="container">
        <h1>Calculadora Avanzada de Cálculo</h1>

        <!-- Examples Section -->
        <div class="examples-section">
            <h2><i class="fas fa-lightbulb"></i> Ejemplos</h2>
            <div class="example-item" onclick="loadExample('derivada', 'sin(x)^2')">
                Derivada de sin²(x)
            </div>
            <div class="example-item" onclick="loadExample('integral', 'x^2')">
                Integral de x²
            </div>
            <div class="example-item" onclick="loadExample('area', 'x^2', 'x')">
                Área entre x² y x
            </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-calculator"></i> Derivadas</h2>
            <div class="math-functions">
                <div class="math-function" onclick="insertFunction('sin(x)')">sin(x)</div>
                <div class="math-function" onclick="insertFunction('cos(x)')">cos(x)</div>
                <div class="math-function" onclick="insertFunction('tan(x)')">tan(x)</div>
                <div class="math-function" onclick="insertFunction('ln(x)')">ln(x)</div>
                <div class="math-function" onclick="insertFunction('e^x')">e^x</div>
                <div class="math-function" onclick="insertFunction('sqrt(x)')">√x</div>
                <div class="math-function" onclick="insertFunction('x^2')">x²</div>
                <div class="math-function" onclick="insertFunction('x^3')">x³</div>
            </div>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion_derivada">Función de x:</label>
                        <input type="text" id="funcion_derivada" name="funcion_derivada" placeholder="Ejemplo: sin(x)^2 + ln(x)" required>
                    </div>
                    <div>
                        <button type="submit" name="derivar">
                            <i class="fas fa-calculator"></i>
                            Calcular Derivada
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_derivada|safe }}</p>
            </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-integral"></i> Integrales</h2>
            <div class="tabs">
                <div class="tab active" onclick="showTab('indefinida')">Integral Indefinida</div>
                <div class="tab" onclick="showTab('definida')">Integral Definida</div>
            </div>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion_integral">Función de x:</label>
                        <input type="text" id="funcion_integral" name="funcion_integral" placeholder="Ejemplo: sin(x)^2 + ln(x)" required>
                    </div>
                    <div id="integral-limits" style="display: none;">
                        <label for="a_integral">Intervalo desde (a):</label>
                        <input type="number" id="a_integral" name="a_integral" step="any" placeholder="Opcional">
                        <label for="b_integral">Intervalo hasta (b):</label>
                        <input type="number" id="b_integral" name="b_integral" step="any" placeholder="Opcional">
                    </div>
                    <div>
                        <button type="submit" name="integrar">
                            <i class="fas fa-calculator"></i>
                            Calcular Integral
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_integral|safe }}</p>
            </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-chart-area"></i> Área entre Curvas</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion1_area">Función de x:</label>
                        <input type="text" id="funcion1_area" name="funcion1_area" placeholder="Ejemplo: sin(x)^2 + ln(x)" required>
                    </div>
                    <div>
                        <label for="funcion2">Segunda función de x:</label>
                        <input type="text" id="funcion2" name="funcion2" placeholder="Ejemplo: x^3" required>
                        <label for="a">Intervalo desde (a):</label>
                        <input type="number" id="a" name="a" step="any" required>
                        <label for="b">Intervalo hasta (b):</label>
                        <input type="number" id="b" name="b" step="any" required>
                        <button type="submit" name="area">
                            <i class="fas fa-calculator"></i>
                            Calcular Área
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p><strong>Resultado:</strong> {{ resultado_decimal_area }} {{ unidad_area }}</p>
            </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-cube"></i> Volumen de Sólido de Revolución</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion1_volumen">Función de x:</label>
                        <input type="text" id="funcion1_volumen" name="funcion1_volumen" placeholder="Ejemplo: sin(x)^2" required>
                    </div>
                    <div>
                        <label for="a_volumen">Intervalo desde (a):</label>
                        <input type="number" id="a_volumen" name="a_volumen" step="any" required>
                        <label for="b_volumen">Intervalo hasta (b):</label>
                        <input type="number" id="b_volumen" name="b_volumen" step="any" required>
                        <button type="submit" name="volumen">
                            <i class="fas fa-calculator"></i>
                            Calcular Volumen
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p><strong>Resultado:</strong> {{ resultado_volumen }}</p>
            </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-infinity"></i> Límites</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion_limites">Función de x:</label>
                        <input type="text" id="funcion_limites" name="funcion_limites" placeholder="Ejemplo: sin(x)/x" required>
                    </div>
                    <div>
                        <label for="punto">Punto de evaluación:</label>
                        <input type="number" id="punto" name="punto" step="any" required>
                        <button type="submit" name="limites">
                            <i class="fas fa-calculator"></i>
                            Calcular Límite
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_limites|safe }}</p>
            </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-sigma"></i> Series de Taylor</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion_series">Función de x:</label>
                        <input type="text" id="funcion_series" name="funcion_series" placeholder="Ejemplo: sin(x)" required>
                    </div>
                    <div>
                        <label for="punto_series">Punto de expansión:</label>
                        <input type="number" id="punto_series" name="punto_series" step="any" required>
                        <label for="orden_series">Orden de la serie:</label>
                        <input type="number" id="orden_series" name="orden_series" min="1" max="10" value="5" required>
                        <button type="submit" name="series">
                            <i class="fas fa-calculator"></i>
                            Calcular Serie
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_series|safe }}</p>
            </div>
        </div>

        <div class="section">
            <h2><i class="fas fa-table"></i> Determinante de Matriz</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="matriz">Matriz (una fila por línea, elementos separados por comas):</label>
                        <textarea id="matriz" name="matriz" rows="4" placeholder="1,2,3&#10;4,5,6&#10;7,8,9" required></textarea>
                    </div>
                    <div>
                        <button type="submit" name="matriz">
                            <i class="fas fa-calculator"></i>
                            Calcular Determinante
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_matriz|safe }}</p>
            </div>
        </div>

        <div class="notes-section">
            <textarea class="note-input" placeholder="Añade una nota a este cálculo..."></textarea>
        </div>

        <div class="comparison-section">
            <div class="comparison-item">
                <h3>Resultado Actual</h3>
                <p id="current-result"></p>
            </div>
            <div class="comparison-item">
                <h3>Resultado Anterior</h3>
                <p id="previous-result"></p>
            </div>
        </div>

        <div class="instructions">
            <h2><i class="fas fa-info-circle"></i> Instrucciones</h2>
            <ul>
                <li><i class="fas fa-check"></i> Usa <strong>^</strong> para potencias (se convierte a **)</li>
                <li><i class="fas fa-check"></i> Usa <strong>*</strong> para multiplicaciones (e.g., 3*x)</li>
                <li><i class="fas fa-check"></i> Funciones soportadas: sin(x), cos(x), tan(x), ln(x), etc.</li>
                <li><i class="fas fa-check"></i> Ejemplos: sin(x)^2, ln(x), e^x, (x^2 + 1)/(x^2 - 1)</li>
                <li><i class="fas fa-check"></i> Para matrices: una fila por línea, elementos separados por comas</li>
            </ul>
        </div>
    </div>

    <script>
        function insertFunction(func) {
            const input = document.activeElement;
            if (input.tagName === 'INPUT' || input.tagName === 'TEXTAREA') {
                const start = input.selectionStart;
                const end = input.selectionEnd;
                input.value = input.value.substring(0, start) + func + input.value.substring(end);
                input.focus();
                input.setSelectionRange(start + func.length, start + func.length);
            }
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const limits = document.getElementById('integral-limits');
            if (tabName === 'definida') {
                limits.style.display = 'block';
            } else {
                limits.style.display = 'none';
            }
        }

        // Theme Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            // Update icon
            const icon = document.querySelector('.theme-toggle i');
            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // History Panel
        function toggleHistory() {
            const panel = document.querySelector('.history-panel');
            panel.classList.toggle('active');
        }

        // Tutorial
        function showTutorial() {
            const overlay = document.querySelector('.tutorial-overlay');
            overlay.classList.add('active');
        }

        function closeTutorial() {
            const overlay = document.querySelector('.tutorial-overlay');
            overlay.classList.remove('active');
        }

        // Favorites
        function toggleFavorite(button) {
            button.classList.toggle('active');
            const icon = button.querySelector('i');
            icon.className = button.classList.contains('active') ? 'fas fa-star' : 'far fa-star';
        }

        // Examples
        function loadExample(type, func1, func2 = null) {
            switch(type) {
                case 'derivada':
                    document.getElementById('funcion_derivada').value = func1;
                    break;
                case 'integral':
                    document.getElementById('funcion_integral').value = func1;
                    break;
                case 'area':
                    document.getElementById('funcion1_area').value = func1;
                    document.getElementById('funcion2').value = func2;
                    break;
            }
        }

        // History Management
        function addToHistory(operation, result) {
            const historyList = document.getElementById('history-list');
            const historyItem = document.createElement('div');
            historyItem.className = 'history-item';
            historyItem.innerHTML = `
                <div class="operation">${operation}</div>
                <div class="result">${result}</div>
            `;
            historyList.insertBefore(historyItem, historyList.firstChild);
        }

        // Initialize theme from localStorage
        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        const themeIcon = document.querySelector('.theme-toggle i');
        themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';

        // Show tutorial on first visit
        if (!localStorage.getItem('tutorialShown')) {
            showTutorial();
            localStorage.setItem('tutorialShown', 'true');
        }

        // Existing functions...
        // ... existing code ...
    </script>
</body>
</html>
