<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Avanzada de Cálculo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6C63FF;
            --secondary-color: #4CAF50;
            --background-dark: #1a1a1a;
            --card-bg: #2d2d2d;
            --text-color: #ffffff;
            --text-secondary: #b3b3b3;
            --accent-color: #FF6B6B;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-dark);
            margin: 0;
            padding: 0;
            color: var(--text-color);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(108, 99, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(76, 175, 80, 0.1) 0%, transparent 20%);
        }

        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        h1 {
            font-size: 42px;
            color: var(--text-color);
            text-align: center;
            margin-bottom: 40px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: relative;
            padding-bottom: 15px;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border-radius: 2px;
        }

        .section {
            background-color: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
            border-color: var(--primary-color);
        }

        .section h2 {
            font-size: 28px;
            color: var(--primary-color);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap: 25px;
            margin-bottom: 25px;
        }

        .form-group label {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: block;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #3d3d3d;
            border-radius: 12px;
            font-size: 16px;
            background-color: #3d3d3d;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.2);
        }

        .form-group button {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .form-group button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.4);
        }

        .result {
            font-size: 18px;
            color: var(--text-color);
            padding: 20px;
            border-radius: 12px;
            background-color: #3d3d3d;
            text-align: center;
            margin-top: 20px;
            border: 1px solid #4d4d4d;
            transition: all 0.3s ease;
        }

        .result:hover {
            border-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(108, 99, 255, 0.2);
        }

        .instructions {
            background-color: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .instructions h2 {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        .instructions ul {
            list-style-type: none;
            padding: 0;
        }

        .instructions li {
            margin-bottom: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .instructions li:hover {
            color: var(--text-color);
            transform: translateX(5px);
        }

        .instructions li i {
            color: var(--primary-color);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background-color: #3d3d3d;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .tab:hover {
            border-color: var(--primary-color);
        }

        .tab.active {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border-color: transparent;
        }

        .math-functions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .math-function {
            background-color: #3d3d3d;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }

        .math-function:hover {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            transform: translateY(-2px);
        }

        .plot-container {
            margin-top: 20px;
            padding: 20px;
            background-color: #3d3d3d;
            border-radius: 12px;
            text-align: center;
        }

        .plot-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .form-group {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 0 15px;
            }

            h1 {
                font-size: 32px;
            }

            .section {
                padding: 20px;
            }
        }

        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            animation: fadeIn 0.5s ease-out;
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Calculadora Avanzada de Cálculo</h1>

        <div class="section">
            <h2><i class="fas fa-calculator"></i> Derivadas</h2>
            <div class="math-functions">
                <div class="math-function" onclick="insertFunction('sin(x)')">sin(x)</div>
                <div class="math-function" onclick="insertFunction('cos(x)')">cos(x)</div>
                <div class="math-function" onclick="insertFunction('tan(x)')">tan(x)</div>
                <div class="math-function" onclick="insertFunction('ln(x)')">ln(x)</div>
                <div class="math-function" onclick="insertFunction('e^x')">e^x</div>
                <div class="math-function" onclick="insertFunction('sqrt(x)')">√x</div>
            </div>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion_derivada">Función de x:</label>
                        <input type="text" id="funcion_derivada" name="funcion_derivada" placeholder="Ejemplo: sin(x)^2 + ln(x)" required>
                    </div>
                    <div>
                        <button type="submit" name="derivar">
                            <i class="fas fa-calculator"></i>
                            Calcular Derivada
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_derivada|safe }}</p>
            </div>
            {% if grafica %}
            <div class="plot-container">
                <img src="data:image/png;base64,{{ grafica }}" alt="Gráfica de la función">
            </div>
            {% endif %}
        </div>

        <div class="section">
            <h2><i class="fas fa-integral"></i> Integrales</h2>
            <div class="tabs">
                <div class="tab active" onclick="showTab('indefinida')">Integral Indefinida</div>
                <div class="tab" onclick="showTab('definida')">Integral Definida</div>
            </div>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion_integral">Función de x:</label>
                        <input type="text" id="funcion_integral" name="funcion_integral" placeholder="Ejemplo: sin(x)^2 + ln(x)" required>
                    </div>
                    <div id="integral-limits">
                        <label for="a_integral">Intervalo desde (a):</label>
                        <input type="number" id="a_integral" name="a_integral" step="any" placeholder="Opcional">
                        <label for="b_integral">Intervalo hasta (b):</label>
                        <input type="number" id="b_integral" name="b_integral" step="any" placeholder="Opcional">
                    </div>
                    <div>
                        <button type="submit" name="integrar">
                            <i class="fas fa-calculator"></i>
                            Calcular Integral
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_integral|safe }}</p>
            </div>
            {% if grafica %}
            <div class="plot-container">
                <img src="data:image/png;base64,{{ grafica }}" alt="Gráfica de la integral">
            </div>
            {% endif %}
        </div>

        <div class="section">
            <h2><i class="fas fa-chart-area"></i> Área entre Curvas</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion1_area">Función de x:</label>
                        <input type="text" id="funcion1_area" name="funcion1_area" placeholder="Ejemplo: sin(x)^2 + ln(x)" required>
                    </div>
                    <div>
                        <label for="funcion2">Segunda función de x:</label>
                        <input type="text" id="funcion2" name="funcion2" placeholder="Ejemplo: x^3">
                        <label for="a">Intervalo desde (a):</label>
                        <input type="number" id="a" name="a" step="any">
                        <label for="b">Intervalo hasta (b):</label>
                        <input type="number" id="b" name="b" step="any">
                        <button type="submit" name="area">
                            <i class="fas fa-calculator"></i>
                            Calcular Área
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p><strong>Resultado:</strong> {{ resultado_decimal_area }} {{ unidad_area }}</p>
            </div>
            {% if grafica %}
            <div class="plot-container">
                <img src="data:image/png;base64,{{ grafica }}" alt="Gráfica del área entre curvas">
            </div>
            {% endif %}
        </div>

        <div class="section">
            <h2><i class="fas fa-cube"></i> Volumen de Sólido de Revolución</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion1_volumen">Función de x:</label>
                        <input type="text" id="funcion1_volumen" name="funcion1_volumen" placeholder="Ejemplo: sin(x)^2" required>
                    </div>
                    <div>
                        <label for="a_volumen">Intervalo desde (a):</label>
                        <input type="number" id="a_volumen" name="a_volumen" step="any" required>
                        <label for="b_volumen">Intervalo hasta (b):</label>
                        <input type="number" id="b_volumen" name="b_volumen" step="any" required>
                        <button type="submit" name="volumen">
                            <i class="fas fa-calculator"></i>
                            Calcular Volumen
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p><strong>Resultado:</strong> {{ resultado_volumen }}</p>
            </div>
            {% if grafica %}
            <div class="plot-container">
                <img src="data:image/png;base64,{{ grafica }}" alt="Gráfica del volumen de revolución">
            </div>
            {% endif %}
        </div>

        <div class="section">
            <h2><i class="fas fa-infinity"></i> Límites</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion_limites">Función de x:</label>
                        <input type="text" id="funcion_limites" name="funcion_limites" placeholder="Ejemplo: sin(x)/x" required>
                    </div>
                    <div>
                        <label for="punto">Punto de evaluación:</label>
                        <input type="number" id="punto" name="punto" step="any" required>
                        <button type="submit" name="limites">
                            <i class="fas fa-calculator"></i>
                            Calcular Límite
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_limites|safe }}</p>
            </div>
            {% if grafica %}
            <div class="plot-container">
                <img src="data:image/png;base64,{{ grafica }}" alt="Gráfica del límite">
            </div>
            {% endif %}
        </div>

        <div class="section">
            <h2><i class="fas fa-sigma"></i> Series de Taylor</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="funcion_series">Función de x:</label>
                        <input type="text" id="funcion_series" name="funcion_series" placeholder="Ejemplo: sin(x)" required>
                    </div>
                    <div>
                        <label for="punto_series">Punto de expansión:</label>
                        <input type="number" id="punto_series" name="punto_series" step="any" required>
                        <label for="orden_series">Orden de la serie:</label>
                        <input type="number" id="orden_series" name="orden_series" min="1" max="10" value="5" required>
                        <button type="submit" name="series">
                            <i class="fas fa-calculator"></i>
                            Calcular Serie
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_series|safe }}</p>
            </div>
            {% if grafica %}
            <div class="plot-container">
                <img src="data:image/png;base64,{{ grafica }}" alt="Gráfica de la serie de Taylor">
            </div>
            {% endif %}
        </div>

        <div class="section">
            <h2><i class="fas fa-table"></i> Determinante de Matriz</h2>
            <form method="post">
                <div class="form-group">
                    <div>
                        <label for="matriz">Matriz (una fila por línea, elementos separados por comas):</label>
                        <textarea id="matriz" name="matriz" rows="4" placeholder="1,2,3&#10;4,5,6&#10;7,8,9" required></textarea>
                    </div>
                    <div>
                        <button type="submit" name="matriz">
                            <i class="fas fa-calculator"></i>
                            Calcular Determinante
                        </button>
                    </div>
                </div>
            </form>
            <div class="result">
                <p>{{ resultado_matriz|safe }}</p>
            </div>
        </div>

        <div class="instructions">
            <h2><i class="fas fa-info-circle"></i> Instrucciones</h2>
            <ul>
                <li><i class="fas fa-check"></i> Usa <strong>^</strong> para potencias (se convierte a **)</li>
                <li><i class="fas fa-check"></i> Usa <strong>*</strong> para multiplicaciones (e.g., 3*x)</li>
                <li><i class="fas fa-check"></i> Funciones soportadas: sin(x), cos(x), tan(x), ln(x), etc.</li>
                <li><i class="fas fa-check"></i> Ejemplos: sin(x)^2, ln(x), e^x, (x^2 + 1)/(x^2 - 1)</li>
                <li><i class="fas fa-check"></i> Para matrices: una fila por línea, elementos separados por comas</li>
            </ul>
        </div>
    </div>

    <script>
        function insertFunction(func) {
            const input = document.activeElement;
            if (input.tagName === 'INPUT' || input.tagName === 'TEXTAREA') {
                const start = input.selectionStart;
                const end = input.selectionEnd;
                input.value = input.value.substring(0, start) + func + input.value.substring(end);
                input.focus();
                input.setSelectionRange(start + func.length, start + func.length);
            }
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            const limits = document.getElementById('integral-limits');
            if (tabName === 'definida') {
                limits.style.display = 'block';
            } else {
                limits.style.display = 'none';
            }
        }

        // Mostrar mensaje de error si existe
        {% if error %}
        alert("{{ error }}");
        {% endif %}

        // Animación suave al hacer scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
